generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  name                    String?
  image                   String?
  emailVerified           DateTime?
  preferences             Json? // User-level preferences including background settings
  subscriptionStatus      String? // 'active', 'canceled', 'past_due', etc.
  subscriptionType        String? // 'pro', 'boost', etc.
  stripeCustomerId        String?                  @unique
  stripeSubscriptionId    String?                  @unique
  subscriptionEndsAt      DateTime?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  accounts                Account[]
  activityLogs            ActivityLog[]
  apiLogs                 ApiLog[]
  attachments             Attachment[]
  attendanceCheckIns      AttendanceCheckIn[]
  clubsCreated            Club[]                   @relation("ClubCreator")
  emailsReceived          EmailLog[]
  errorLogs               ErrorLog[]
  eventRSVPs              EventRSVP[]
  formSubmissions         FormSubmission[]         @relation("FormSubmissions")
  homePageWidgets         HomePageWidget[]         @relation("UserHomePageWidgets")
  mediaUploads            MediaItem[]              @relation("MediaUploads")
  memberships             Membership[]
  reactions               Reaction[]
  sessions                Session[]
  tournamentsCreated      Tournament[]             @relation("TournamentCreator")
  tournamentAdmins        TournamentAdmin[]        @relation("TournamentAdmins")
  tournamentRegistrations TournamentRegistration[] @relation("TournamentRegistrationsBy")
  tournamentStaff         TournamentStaff[]        @relation("TournamentStaffUser")
  promoCodeRedemptions    PromoCodeRedemption[]    @relation("PromoCodeRedemptions")
  clubBoosts              ClubBoost[]              @relation("UserClubBoosts")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Club {
  id                        String                   @id @default(cuid())
  name                      String
  division                  Division
  createdById               String
  adminInviteCodeHash       String
  memberInviteCodeHash      String
  adminInviteCodeEncrypted  String
  memberInviteCodeEncrypted String
  backgroundType            String                   @default("grid")
  backgroundColor           String?
  gradientStartColor        String?
  gradientEndColor          String?
  gradientColors            String[]                 @default([])
  gradientDirection         String?
  backgroundImageUrl        String?
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @updatedAt
  albums                    Album[]
  announcements             Announcement[]
  calendarEvents            CalendarEvent[]
  createdBy                 User                     @relation("ClubCreator", fields: [createdById], references: [id])
  eventBudgets              EventBudget[]
  expenses                  Expense[]
  forms                     Form[]
  homePageWidgets           HomePageWidget[]
  memberships               Membership[]
  purchaseRequests          PurchaseRequest[]
  resources                 Resource[]
  resourceRequests          ResourceRequest[]        @relation("ResourceRequests")
  teams                     Team[]
  tests                     Test[]
  todos                     Todo[]
  tournamentRegistrations   TournamentRegistration[] @relation("TournamentRegistrations")
  clubBoosts                ClubBoost[]              @relation("ClubBoosts")

  @@index([createdById])
}

model Membership {
  id                  String              @id @default(cuid())
  userId              String
  clubId              String
  role                Role
  teamId              String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  roles               String[]            @default([])
  announcements       Announcement[]
  announcementReplies AnnouncementReply[] @relation("AnnouncementReplies")
  attendanceCheckIns  AttendanceCheckIn[]
  attendeeEvents      CalendarEvent[]     @relation("AttendeeEvents")
  calendarEvents      CalendarEvent[]     @relation("CreatorEvents")
  esTestAttempts      ESTestAttempt[]
  preferences         MemberPreferences?
  club                Club                @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team                Team?               @relation(fields: [teamId], references: [id])
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  noteSheets          NoteSheet[]
  reviewedNoteSheets  NoteSheet[]         @relation("NoteSheetReviewer")
  resourceRequests    ResourceRequest[]
  rosterAssignments   RosterAssignment[]
  todos               Todo[]

  @@unique([userId, clubId])
  @@index([clubId])
  @@index([teamId])
}

model Team {
  id                       String                   @id @default(cuid())
  clubId                   String
  name                     String
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  announcementVisibilities AnnouncementVisibility[]
  calendarEvents           CalendarEvent[]
  eventBudgets             EventBudget[]
  expenses                 Expense[]
  members                  Membership[]
  purchaseRequests         PurchaseRequest[]
  rosterAssignments        RosterAssignment[]
  club                     Club                     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  testAssignments          TestAssignment[]
  tournamentRegistrations  TournamentRegistration[] @relation("TournamentRegistrations")

  @@index([clubId])
}

model Event {
  id                        String                      @id @default(cuid())
  division                  Division
  name                      String
  slug                      String
  maxCompetitors            Int                         @default(2)
  selfScheduled             Boolean                     @default(false)
  createdAt                 DateTime                    @default(now())
  announcementVisibilities  AnnouncementVisibility[]
  calendarEventTargets      CalendarEventTarget[]
  conflictGroupEvents       ConflictGroupEvent[]
  esTests                   ESTest[]
  eventBudgets              EventBudget[]
  esAssignments             EventSupervisorAssignment[]
  expenses                  Expense[]
  purchaseRequests          PurchaseRequest[]
  rosterAssignments         RosterAssignment[]
  testAssignments           TestAssignment[]
  tournamentEventSelections TournamentEventSelection[]
  tournamentTestEvents      TournamentTest[]            @relation("TournamentTestEvents")

  @@unique([division, slug])
  @@index([division])
}

model ConflictGroup {
  id          String               @id @default(cuid())
  division    Division
  blockNumber Int
  name        String
  createdAt   DateTime             @default(now())
  events      ConflictGroupEvent[]

  @@unique([division, blockNumber])
  @@index([division])
}

model ConflictGroupEvent {
  id              String        @id @default(cuid())
  conflictGroupId String
  eventId         String
  createdAt       DateTime      @default(now())
  conflictGroup   ConflictGroup @relation(fields: [conflictGroupId], references: [id], onDelete: Cascade)
  event           Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([conflictGroupId, eventId])
  @@index([eventId])
}

model RosterAssignment {
  id           String     @id @default(cuid())
  teamId       String
  membershipId String
  eventId      String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  event        Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  membership   Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  team         Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([membershipId, eventId])
  @@index([teamId, eventId])
  @@index([eventId])
}

model Announcement {
  id              String                   @id @default(cuid())
  clubId          String
  authorId        String
  title           String
  content         String
  calendarEventId String?                  @unique
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt
  important       Boolean                  @default(false)
  author          Membership               @relation(fields: [authorId], references: [id], onDelete: Cascade)
  calendarEvent   CalendarEvent?           @relation(fields: [calendarEventId], references: [id], onDelete: Cascade)
  club            Club                     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  replies         AnnouncementReply[]
  visibilities    AnnouncementVisibility[]
  attachments     Attachment[]
  emails          EmailLog[]
  reactions       Reaction[]

  @@index([clubId])
  @@index([authorId])
  @@index([createdAt])
  @@index([calendarEventId])
}

model AnnouncementReply {
  id             String       @id @default(cuid())
  announcementId String
  authorId       String
  content        String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  author         Membership   @relation("AnnouncementReplies", fields: [authorId], references: [id], onDelete: Cascade)
  reactions      Reaction[]

  @@index([announcementId])
  @@index([authorId])
  @@index([createdAt])
}

model Reaction {
  id             String             @id @default(cuid())
  emoji          String
  userId         String
  createdAt      DateTime           @default(now())
  announcementId String?
  eventId        String?
  replyId        String?
  announcement   Announcement?      @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  calendarEvent  CalendarEvent?     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  reply          AnnouncementReply? @relation(fields: [replyId], references: [id], onDelete: Cascade)
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, announcementId, emoji], name: "userId_announcementId_emoji")
  @@unique([userId, eventId, emoji], name: "userId_eventId_emoji")
  @@unique([userId, replyId, emoji], name: "userId_replyId_emoji")
  @@index([announcementId])
  @@index([eventId])
  @@index([replyId])
  @@index([userId])
}

model AnnouncementVisibility {
  id             String            @id @default(cuid())
  announcementId String
  scope          AnnouncementScope
  teamId         String?
  targetRole     String?
  eventId        String?
  createdAt      DateTime          @default(now())
  announcement   Announcement      @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  event          Event?            @relation(fields: [eventId], references: [id], onDelete: Cascade)
  team           Team?             @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([announcementId])
  @@index([teamId])
  @@index([eventId])
  @@index([targetRole])
}

model CalendarEvent {
  id                   String                @id @default(cuid())
  clubId               String
  creatorId            String
  scope                CalendarScope
  title                String
  description          String?
  startUTC             DateTime
  endUTC               DateTime
  location             String?
  color                String?
  teamId               String?
  attendeeId           String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  rsvpEnabled          Boolean               @default(true)
  important            Boolean               @default(false)
  isRecurring          Boolean               @default(false)
  recurrenceRule       String?
  recurrenceInterval   Int?                  @default(1)
  recurrenceDaysOfWeek Int[]
  recurrenceEndDate    DateTime?
  recurrenceCount      Int?
  parentEventId        String?
  recurrenceExceptions DateTime[]
  testId               String?
  announcement         Announcement?
  attachments          Attachment[]
  attendance           Attendance?
  attendee             Membership?           @relation("AttendeeEvents", fields: [attendeeId], references: [id], onDelete: Cascade)
  club                 Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  creator              Membership            @relation("CreatorEvents", fields: [creatorId], references: [id], onDelete: Cascade)
  parentEvent          CalendarEvent?        @relation("RecurringEvents", fields: [parentEventId], references: [id], onDelete: Cascade)
  childEvents          CalendarEvent[]       @relation("RecurringEvents")
  team                 Team?                 @relation(fields: [teamId], references: [id], onDelete: Cascade)
  test                 Test?                 @relation(fields: [testId], references: [id])
  targets              CalendarEventTarget[]
  rsvps                EventRSVP[]
  reactions            Reaction[]

  @@index([clubId])
  @@index([creatorId])
  @@index([teamId])
  @@index([attendeeId])
  @@index([startUTC])
  @@index([parentEventId])
  @@index([isRecurring])
  @@index([testId])
}

model CalendarEventTarget {
  id              String        @id @default(cuid())
  calendarEventId String
  targetRole      String?
  eventId         String?
  createdAt       DateTime      @default(now())
  calendarEvent   CalendarEvent @relation(fields: [calendarEventId], references: [id], onDelete: Cascade)
  event           Event?        @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([calendarEventId])
  @@index([eventId])
  @@index([targetRole])
}

model EventRSVP {
  id        String        @id @default(cuid())
  eventId   String
  userId    String
  status    RSVPStatus
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  event     CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

model EmailLog {
  id                String        @id @default(cuid())
  announcementId    String?
  toUserId          String
  subject           String
  providerMessageId String?
  sentAt            DateTime      @default(now())
  announcement      Announcement? @relation(fields: [announcementId], references: [id])
  toUser            User          @relation(fields: [toUserId], references: [id], onDelete: Cascade)

  @@index([announcementId])
  @@index([toUserId])
}

model Attendance {
  id              String                  @id @default(cuid())
  calendarEventId String                  @unique
  clubId          String
  codeHash        String
  graceMinutes    Int                     @default(0)
  status          AttendanceStatus        @default(UPCOMING)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  calendarEvent   CalendarEvent           @relation(fields: [calendarEventId], references: [id], onDelete: Cascade)
  checkIns        AttendanceCheckIn[]
  codeAttempts    AttendanceCodeAttempt[]

  @@index([clubId])
  @@index([calendarEventId])
  @@index([status])
}

model AttendanceCheckIn {
  id           String        @id @default(cuid())
  attendanceId String
  userId       String
  membershipId String
  source       CheckInSource
  reason       String?
  checkedInAt  DateTime      @default(now())
  createdAt    DateTime      @default(now())
  attendance   Attendance    @relation(fields: [attendanceId], references: [id], onDelete: Cascade)
  membership   Membership    @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([attendanceId, userId])
  @@index([attendanceId])
  @@index([userId])
  @@index([membershipId])
}

model AttendanceCodeAttempt {
  id           String     @id @default(cuid())
  attendanceId String
  userId       String?
  ipAddress    String
  attemptedAt  DateTime   @default(now())
  success      Boolean
  attendance   Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  @@index([attendanceId, userId, attemptedAt])
  @@index([attendanceId, ipAddress, attemptedAt])
}

model Attachment {
  id               String         @id @default(cuid())
  filename         String
  originalFilename String
  fileSize         Int
  mimeType         String
  filePath         String
  announcementId   String?
  calendarEventId  String?
  uploadedById     String
  createdAt        DateTime       @default(now())
  announcement     Announcement?  @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  calendarEvent    CalendarEvent? @relation(fields: [calendarEventId], references: [id], onDelete: Cascade)
  uploadedBy       User           @relation(fields: [uploadedById], references: [id], onDelete: Cascade)

  @@index([announcementId])
  @@index([calendarEventId])
  @@index([uploadedById])
}

model Expense {
  id                String           @id @default(cuid())
  clubId            String
  description       String
  category          String?
  amount            Float
  date              DateTime
  notes             String?
  purchaseRequestId String?          @unique
  addedById         String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  eventId           String?
  teamId            String?
  club              Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  event             Event?           @relation(fields: [eventId], references: [id])
  purchaseRequest   PurchaseRequest? @relation(fields: [purchaseRequestId], references: [id])
  team              Team?            @relation(fields: [teamId], references: [id])

  @@index([clubId])
  @@index([eventId])
  @@index([teamId])
  @@index([date])
  @@index([addedById])
}

model PurchaseRequest {
  id              String                @id @default(cuid())
  clubId          String
  requesterId     String
  description     String
  category        String?
  estimatedAmount Float
  justification   String?
  status          PurchaseRequestStatus @default(PENDING)
  reviewedById    String?
  reviewNote      String?
  reviewedAt      DateTime?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  adminOverride   Boolean               @default(false)
  eventId         String?
  teamId          String?
  expense         Expense?
  club            Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  event           Event?                @relation(fields: [eventId], references: [id])
  team            Team?                 @relation(fields: [teamId], references: [id])

  @@index([clubId])
  @@index([eventId])
  @@index([teamId])
  @@index([requesterId])
  @@index([status])
  @@index([createdAt])
}

model EventBudget {
  id        String   @id @default(cuid())
  clubId    String
  eventId   String
  maxBudget Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  teamId    String?
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  team      Team?    @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([clubId, eventId, teamId])
  @@index([clubId])
  @@index([eventId])
  @@index([teamId])
}

model Test {
  id                     String                @id @default(cuid())
  clubId                 String
  name                   String
  description            String?
  instructions           String?
  status                 TestStatus            @default(DRAFT)
  durationMinutes        Int
  startAt                DateTime?
  endAt                  DateTime?
  allowLateUntil         DateTime?
  randomizeQuestionOrder Boolean               @default(false)
  randomizeOptionOrder   Boolean               @default(false)
  requireFullscreen      Boolean               @default(true)
  testPasswordHash       String?
  testPasswordPlaintext  String?
  releaseScoresAt        DateTime?
  maxAttempts            Int?
  scoreReleaseMode       ScoreReleaseMode      @default(FULL_TEST)
  allowCalculator        Boolean               @default(false)
  calculatorType         CalculatorType?
  allowNoteSheet         Boolean               @default(false)
  noteSheetInstructions  String?
  autoApproveNoteSheet   Boolean               @default(true)
  requireOneSitting      Boolean               @default(true)
  createdByMembershipId  String
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  aiSuggestions          AiGradingSuggestion[]
  calendarEvents         CalendarEvent[]
  noteSheets             NoteSheet[]
  questions              Question[]
  club                   Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  assignments            TestAssignment[]
  attempts               TestAttempt[]
  audits                 TestAudit[]
  sections               TestSection[]
  tournamentTests        TournamentTest[]      @relation("TournamentTests")

  @@index([clubId])
  @@index([status])
  @@index([createdByMembershipId])
}

model NoteSheet {
  id              String          @id @default(cuid())
  testId          String? // Nullable to support ESTest
  esTestId        String? // Support for ESTest note sheets
  membershipId    String
  type            NoteSheetType
  content         String?
  filePath        String?
  filename        String?
  fileSize        Int?
  mimeType        String?
  status          NoteSheetStatus @default(PENDING)
  rejectionReason String?
  reviewedById    String?
  reviewedAt      DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  membership      Membership      @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  reviewer        Membership?     @relation("NoteSheetReviewer", fields: [reviewedById], references: [id])
  test            Test?           @relation(fields: [testId], references: [id], onDelete: Cascade)
  esTest          ESTest?         @relation(fields: [esTestId], references: [id], onDelete: Cascade)

  @@unique([testId, membershipId])
  @@unique([esTestId, membershipId])
  @@index([testId])
  @@index([esTestId])
  @@index([membershipId])
  @@index([status])
  @@index([reviewedById])
}

model TestSection {
  id        String     @id @default(cuid())
  testId    String
  title     String?
  order     Int        @default(0)
  createdAt DateTime   @default(now())
  questions Question[]
  test      Test       @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
}

model Question {
  id               String                @id @default(cuid())
  testId           String
  sectionId        String?
  type             QuestionType
  promptMd         String
  explanation      String?
  points           Decimal               @db.Decimal(5, 2)
  order            Int                   @default(0)
  shuffleOptions   Boolean               @default(false)
  numericTolerance Decimal?              @db.Decimal(8, 3)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  aiSuggestions    AiGradingSuggestion[]
  answers          AttemptAnswer[]
  section          TestSection?          @relation(fields: [sectionId], references: [id])
  test             Test                  @relation(fields: [testId], references: [id], onDelete: Cascade)
  options          QuestionOption[]

  @@index([testId])
  @@index([sectionId])
}

model QuestionOption {
  id         String   @id @default(cuid())
  questionId String
  label      String
  isCorrect  Boolean  @default(false)
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId])
}

model TestAssignment {
  id                 String              @id @default(cuid())
  testId             String
  assignedScope      TestAssignmentScope
  teamId             String?
  targetMembershipId String?
  targetRole         String?
  eventId            String?
  createdAt          DateTime            @default(now())
  event              Event?              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  team               Team?               @relation(fields: [teamId], references: [id], onDelete: Cascade)
  test               Test                @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
  @@index([teamId])
  @@index([targetMembershipId])
  @@index([eventId])
  @@index([targetRole])
}

model TestAttempt {
  id                    String                @id @default(cuid())
  testId                String
  membershipId          String
  status                AttemptStatus         @default(NOT_STARTED)
  startedAt             DateTime?
  submittedAt           DateTime?
  gradeEarned           Decimal?              @db.Decimal(6, 2)
  proctoringScore       Int?
  clientFingerprintHash String?
  ipAtStart             String?
  ipAtSubmit            String?
  userAgentAtStart      String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  tabSwitchCount        Int                   @default(0)
  timeOffPageSeconds    Int                   @default(0)
  aiSuggestions         AiGradingSuggestion[]
  answers               AttemptAnswer[]
  gradeAdjustments      GradeAdjustment[]
  proctorEvents         ProctorEvent[]
  test                  Test                  @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
  @@index([membershipId])
  @@index([membershipId, testId])
  @@index([status])
}

model AttemptAnswer {
  id                String                @id @default(cuid())
  attemptId         String
  questionId        String
  answerText        String?
  selectedOptionIds Json?
  numericAnswer     Decimal?              @db.Decimal(16, 6)
  pointsAwarded     Decimal?              @db.Decimal(5, 2)
  gradedAt          DateTime?
  graderNote        String?
  markedForReview   Boolean               @default(false)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  aiSuggestions     AiGradingSuggestion[]
  attempt           TestAttempt           @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question          Question              @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([attemptId, questionId])
  @@index([attemptId])
  @@index([questionId])
}

model ProctorEvent {
  id          String           @id @default(cuid())
  attemptId   String?          // Optional for regular TestAttempt
  esAttemptId String?          // Optional for ESTestAttempt
  kind        ProctorEventKind
  ts          DateTime         @default(now())
  meta        Json?
  attempt     TestAttempt?     @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  esAttempt   ESTestAttempt?   @relation(fields: [esAttemptId], references: [id], onDelete: Cascade)

  @@index([attemptId])
  @@index([esAttemptId])
  @@index([ts])
}

model GradeAdjustment {
  id                 String      @id @default(cuid())
  attemptId          String
  graderMembershipId String
  deltaPoints        Decimal     @db.Decimal(6, 2)
  reason             String
  createdAt          DateTime    @default(now())
  attempt            TestAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)

  @@index([attemptId])
}

model AiGradingSuggestion {
  id                      String             @id @default(cuid())
  testId                  String
  attemptId               String
  answerId                String
  questionId              String
  requestedByUserId       String
  requestedByMembershipId String?
  suggestedPoints         Decimal            @db.Decimal(5, 2)
  maxPoints               Decimal            @db.Decimal(5, 2)
  explanation             String
  strengths               String?
  gaps                    String?
  rubricAlignment         String?
  rawResponse             Json?
  status                  AiSuggestionStatus @default(SUGGESTED)
  acceptedPoints          Decimal?           @db.Decimal(5, 2)
  acceptedAt              DateTime?
  acceptedByUserId        String?
  acceptedByMembershipId  String?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  // Optional relations - can be null for ES tests
  answer                  AttemptAnswer?     @relation(fields: [answerId], references: [id], onDelete: Cascade)
  attempt                 TestAttempt?       @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question                Question?          @relation(fields: [questionId], references: [id], onDelete: Cascade)
  test                    Test?              @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([attemptId])
  @@index([answerId])
  @@index([questionId])
  @@index([testId])
  @@index([requestedByUserId])
  @@index([status])
}

model TestAudit {
  id                String          @id @default(cuid())
  testId            String?
  actorMembershipId String
  action            TestAuditAction
  details           Json?
  createdAt         DateTime        @default(now())
  test              Test?           @relation(fields: [testId], references: [id])

  @@index([testId])
  @@index([actorMembershipId])
  @@index([createdAt])
}

model ActivityLog {
  id          String        @id @default(cuid())
  action      String
  description String
  userId      String?
  metadata    Json?
  timestamp   DateTime      @default(now())
  logType     LogType       @default(SYSTEM_EVENT)
  severity    SeverityLevel @default(INFO)
  route       String?
  user        User?         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([timestamp])
  @@index([action])
  @@index([logType])
  @@index([severity])
  @@index([route])
}

model ApiLog {
  id            String   @id @default(cuid())
  method        String
  route         String
  statusCode    Int
  userId        String?
  executionTime Int
  ipAddress     String?
  userAgent     String?
  requestBody   Json?
  responseSize  Int?
  error         String?
  timestamp     DateTime @default(now())
  user          User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([timestamp])
  @@index([route])
  @@index([method])
  @@index([statusCode])
  @@index([executionTime])
}

model ErrorLog {
  id        String        @id @default(cuid())
  errorType String
  message   String
  stack     String?
  userId    String?
  route     String?
  severity  SeverityLevel @default(ERROR)
  metadata  Json?
  timestamp DateTime      @default(now())
  resolved  Boolean       @default(false)
  user      User?         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([timestamp])
  @@index([severity])
  @@index([route])
  @@index([resolved])
}

model HomePageWidget {
  id         String         @id @default(cuid())
  clubId     String
  ownerId    String?
  widgetType HomeWidgetType
  title      String?
  position   Int            @default(0)
  width      WidgetWidth    @default(MEDIUM)
  height     WidgetHeight   @default(MEDIUM)
  isVisible  Boolean        @default(true)
  config     Json?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  club       Club           @relation(fields: [clubId], references: [id], onDelete: Cascade)
  owner      User?          @relation("UserHomePageWidgets", fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([ownerId])
  @@index([clubId, ownerId])
  @@index([position])
  @@index([isVisible])
}

model Album {
  id            String      @id @default(cuid())
  clubId        String
  name          String
  description   String?
  coverImageUrl String?
  createdById   String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  club          Club        @relation(fields: [clubId], references: [id], onDelete: Cascade)
  media         MediaItem[]

  @@index([clubId])
  @@index([createdById])
  @@index([createdAt])
}

model MediaItem {
  id               String    @id @default(cuid())
  albumId          String?
  clubId           String
  filename         String
  originalFilename String
  fileSize         Int
  mimeType         String
  filePath         String
  mediaType        MediaType
  width            Int?
  height           Int?
  duration         Int?
  thumbnailPath    String?
  caption          String?
  uploadedById     String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  album            Album?    @relation(fields: [albumId], references: [id], onDelete: Cascade)
  uploadedBy       User      @relation("MediaUploads", fields: [uploadedById], references: [id], onDelete: Cascade)

  @@index([albumId])
  @@index([clubId])
  @@index([uploadedById])
  @@index([createdAt])
  @@index([mediaType])
}

model Form {
  id               String           @id @default(cuid())
  clubId           String
  title            String
  description      String?
  filename         String
  originalFilename String
  fileSize         Int
  mimeType         String
  filePath         String
  dueDate          DateTime?
  isRequired       Boolean          @default(false)
  uploadedById     String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  club             Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  submissions      FormSubmission[]

  @@index([clubId])
  @@index([uploadedById])
  @@index([dueDate])
  @@index([isRequired])
}

model FormSubmission {
  id               String           @id @default(cuid())
  formId           String
  userId           String
  membershipId     String
  filename         String
  originalFilename String
  fileSize         Int
  mimeType         String
  filePath         String
  status           SubmissionStatus @default(PENDING)
  notes            String?
  submittedAt      DateTime         @default(now())
  reviewedAt       DateTime?
  reviewedById     String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  form             Form             @relation(fields: [formId], references: [id], onDelete: Cascade)
  user             User             @relation("FormSubmissions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([formId, userId])
  @@index([formId])
  @@index([userId])
  @@index([membershipId])
  @@index([status])
}

model Todo {
  id           String       @id @default(cuid())
  clubId       String
  membershipId String
  title        String
  description  String?
  completed    Boolean      @default(false)
  priority     TodoPriority @default(MEDIUM)
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  club         Club         @relation(fields: [clubId], references: [id], onDelete: Cascade)
  membership   Membership   @relation(fields: [membershipId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([membershipId])
  @@index([completed])
  @@index([priority])
  @@index([dueDate])
}

model MemberPreferences {
  id                 String     @id @default(cuid())
  membershipId       String     @unique
  preferredEvents    String[]   @default([])
  avoidEvents        String[]   @default([])
  adminNotes         String?
  strengths          String?
  weaknesses         String?
  availability       String?
  experienceLevel    String?
  backgroundType     String?
  backgroundColor    String?
  gradientStartColor String?
  gradientEndColor   String?
  gradientColors     String[]   @default([])
  gradientDirection  String?
  backgroundImageUrl String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  membership         Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)

  @@index([membershipId])
}

model StudyNote {
  id           String        @id @default(cuid())
  clubId       String
  membershipId String
  eventSlug    String
  title        String
  content      String
  noteType     StudyNoteType
  sheetCount   Int           @default(1)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@unique([clubId, membershipId, eventSlug])
  @@index([clubId])
  @@index([membershipId])
  @@index([eventSlug])
}

model AIRosterGeneration {
  id              String    @id @default(cuid())
  clubId          String
  teamId          String?
  prompt          String
  response        String
  generatedRoster Json
  appliedAt       DateTime?
  createdAt       DateTime  @default(now())
  createdById     String

  @@index([clubId])
  @@index([teamId])
  @@index([createdAt])
}

model SiteSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
}

model Tournament {
  id                      String                    @id @default(cuid())
  name                    String
  division                Division
  description             String?
  price                   Float                     @default(0)
  startDate               DateTime
  endDate                 DateTime
  startTime               DateTime
  endTime                 DateTime
  location                String?
  createdById             String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  paymentInstructions     String?
  isOnline                Boolean                   @default(false)
  approved                Boolean                   @default(false)
  rejectionReason         String?
  hostingRequestId        String?                   @unique
  pageContent             String?
  slug                    String?                   @unique
  additionalTeamPrice     Float?
  earlyBirdDeadline       DateTime?
  earlyBirdDiscount       Float?
  eligibilityRequirements String?
  eventsRun               String?
  feeStructure            String                    @default("flat")
  lateFee                 Float?
  lateFeeStartDate        DateTime?
  otherDiscounts          String?
  registrationEndDate     DateTime?
  registrationStartDate   DateTime?
  published               Boolean                   @default(false)
  trialEvents             String?
  // Default test creation settings
  defaultDurationMinutes  Int?
  defaultStartAt          DateTime?
  defaultEndAt            DateTime?
  defaultReleaseScoresAt  DateTime?
  defaultScoreReleaseMode ScoreReleaseMode?
  defaultRequireFullscreen Boolean?
  defaultAllowCalculator  Boolean?
  defaultCalculatorType   CalculatorType?
  defaultAllowNoteSheet   Boolean?
  defaultAutoApproveNoteSheet Boolean?
  defaultRequireOneSitting Boolean?
  defaultMaxAttempts      Int?
  esTests                 ESTest[]
  createdBy               User                      @relation("TournamentCreator", fields: [createdById], references: [id], onDelete: Cascade)
  hostingRequest          TournamentHostingRequest? @relation("TournamentFromRequest", fields: [hostingRequestId], references: [id])
  admins                  TournamentAdmin[]
  registrations           TournamentRegistration[]
  staff                   TournamentStaff[]
  tests                   TournamentTest[]
  timeline                TournamentTimeline[]

  @@index([createdById])
  @@index([startDate])
  @@index([endDate])
  @@index([division])
  @@index([approved])
  @@index([published])
  @@index([slug])
  @@index([hostingRequestId])
}

model TournamentAdmin {
  id           String     @id @default(cuid())
  tournamentId String
  userId       String
  createdAt    DateTime   @default(now())
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  user         User       @relation("TournamentAdmins", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, userId])
  @@index([tournamentId])
  @@index([userId])
}

model TournamentRegistration {
  id              String                       @id @default(cuid())
  tournamentId    String
  clubId          String
  teamId          String?
  registeredById  String
  status          TournamentRegistrationStatus @default(PENDING)
  createdAt       DateTime                     @default(now())
  updatedAt       DateTime                     @updatedAt
  paid            Boolean                      @default(false)
  eventSelections TournamentEventSelection[]
  club            Club                         @relation("TournamentRegistrations", fields: [clubId], references: [id], onDelete: Cascade)
  registeredBy    User                         @relation("TournamentRegistrationsBy", fields: [registeredById], references: [id], onDelete: Cascade)
  team            Team?                        @relation("TournamentRegistrations", fields: [teamId], references: [id], onDelete: Cascade)
  tournament      Tournament                   @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, clubId, teamId])
  @@index([tournamentId])
  @@index([clubId])
  @@index([teamId])
  @@index([registeredById])
  @@index([status])
}

model TournamentEventSelection {
  id             String                 @id @default(cuid())
  registrationId String
  eventId        String
  createdAt      DateTime               @default(now())
  event          Event                  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  registration   TournamentRegistration @relation(fields: [registrationId], references: [id], onDelete: Cascade)

  @@unique([registrationId, eventId])
  @@index([registrationId])
  @@index([eventId])
}

model TournamentTest {
  id           String     @id @default(cuid())
  tournamentId String
  testId       String
  eventId      String?
  createdAt    DateTime   @default(now())
  event        Event?     @relation("TournamentTestEvents", fields: [eventId], references: [id])
  test         Test       @relation("TournamentTests", fields: [testId], references: [id], onDelete: Cascade)
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, testId])
  @@index([tournamentId])
  @@index([testId])
  @@index([eventId])
}

model TournamentHostingRequest {
  id               String                         @id @default(cuid())
  tournamentName   String
  tournamentLevel  String
  division         String
  tournamentFormat String
  location         String?
  preferredSlug    String?
  directorName     String
  directorEmail    String
  directorPhone    String?
  otherNotes       String?
  status           TournamentHostingRequestStatus @default(PENDING)
  reviewNotes      String?
  createdAt        DateTime                       @default(now())
  updatedAt        DateTime                       @updatedAt
  pageContent      String?
  tournament       Tournament?                    @relation("TournamentFromRequest")

  @@index([status])
  @@index([createdAt])
  @@index([directorEmail])
}

model BlogPost {
  id         String   @id @default(cuid())
  slug       String   @unique
  title      String
  excerpt    String?
  content    String
  coverImage String?
  published  Boolean  @default(false)
  authorName String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([published])
  @@index([createdAt])
}

model TournamentStaff {
  id           String                      @id @default(cuid())
  tournamentId String
  email        String
  name         String?
  role         StaffRole
  status       StaffInviteStatus           @default(PENDING)
  inviteToken  String                      @unique
  invitedAt    DateTime                    @default(now())
  acceptedAt   DateTime?
  userId       String?
  createdAt    DateTime                    @default(now())
  updatedAt    DateTime                    @updatedAt
  trialEvents  String?
  testsCreated ESTest[]                    @relation("ESTestCreator")
  tests        ESTest[]                    @relation("ESTestOwner")
  testsAudited ESTestAudit[]               @relation("ESTestAuditActor")
  events       EventSupervisorAssignment[]
  tournament   Tournament                  @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  user         User?                       @relation("TournamentStaffUser", fields: [userId], references: [id])

  @@unique([tournamentId, email])
  @@index([tournamentId])
  @@index([email])
  @@index([userId])
  @@index([status])
}

model EventSupervisorAssignment {
  id        String          @id @default(cuid())
  staffId   String
  eventId   String
  createdAt DateTime        @default(now())
  event     Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  staff     TournamentStaff @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, eventId])
  @@index([staffId])
  @@index([eventId])
}

model TournamentTimeline {
  id           String     @id @default(cuid())
  tournamentId String
  name         String
  description  String?
  dueDate      DateTime
  type         String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@index([tournamentId])
  @@index([dueDate])
}

model ESTest {
  id                    String           @id @default(cuid())
  staffId               String
  tournamentId          String
  eventId               String?
  name                  String
  description           String?
  instructions          String?
  content               String?
  status                TestStatus       @default(DRAFT)
  durationMinutes       Int              @default(60)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  createdByStaffId      String
  allowLateUntil        DateTime?
  endAt                 DateTime?
  startAt               DateTime?
  requireFullscreen     Boolean          @default(true)
  allowCalculator       Boolean          @default(false)
  allowNoteSheet        Boolean          @default(false)
  calculatorType        CalculatorType?
  noteSheetInstructions String?
  autoApproveNoteSheet  Boolean          @default(true)
  requireOneSitting     Boolean          @default(true)
  releaseScoresAt       DateTime?
  scoreReleaseMode      ScoreReleaseMode @default(FULL_TEST)
  scoresReleased        Boolean          @default(false)
  maxAttempts           Int?
  createdBy             TournamentStaff  @relation("ESTestCreator", fields: [createdByStaffId], references: [id], onDelete: Cascade)
  event                 Event?           @relation(fields: [eventId], references: [id])
  staff                 TournamentStaff  @relation("ESTestOwner", fields: [staffId], references: [id], onDelete: Cascade)
  tournament            Tournament       @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  attempts              ESTestAttempt[]
  audits                ESTestAudit[]
  questions             ESTestQuestion[]
  noteSheets            NoteSheet[]

  @@index([staffId])
  @@index([createdByStaffId])
  @@index([tournamentId])
  @@index([eventId])
  @@index([status])
}

model ESTestQuestion {
  id               String                 @id @default(cuid())
  testId           String
  type             QuestionType
  promptMd         String
  explanation      String?
  points           Decimal                @db.Decimal(5, 2)
  order            Int                    @default(0)
  shuffleOptions   Boolean                @default(false)
  numericTolerance Decimal?               @db.Decimal(8, 3)
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  answers          ESTestAttemptAnswer[]
  test             ESTest                 @relation(fields: [testId], references: [id], onDelete: Cascade)
  options          ESTestQuestionOption[]

  @@index([testId])
}

model ESTestQuestionOption {
  id         String         @id @default(cuid())
  questionId String
  label      String
  isCorrect  Boolean        @default(false)
  order      Int            @default(0)
  createdAt  DateTime       @default(now())
  question   ESTestQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId])
}

model ESTestAudit {
  id           String          @id @default(cuid())
  testId       String?
  actorStaffId String
  action       TestAuditAction
  details      Json?
  createdAt    DateTime        @default(now())
  actorStaff   TournamentStaff @relation("ESTestAuditActor", fields: [actorStaffId], references: [id], onDelete: Cascade)
  test         ESTest?         @relation(fields: [testId], references: [id])

  @@index([testId])
  @@index([actorStaffId])
  @@index([createdAt])
}

model ESTestAttempt {
  id                    String                @id @default(cuid())
  testId                String
  membershipId          String
  status                AttemptStatus         @default(NOT_STARTED)
  startedAt             DateTime?
  submittedAt           DateTime?
  gradeEarned           Decimal?              @db.Decimal(6, 2)
  proctoringScore       Int?
  clientFingerprintHash String?
  ipAtStart             String?
  ipAtSubmit            String?
  userAgentAtStart      String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  tabSwitchCount        Int                   @default(0)
  timeOffPageSeconds    Int                   @default(0)
  membership            Membership            @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  test                  ESTest                @relation(fields: [testId], references: [id], onDelete: Cascade)
  answers               ESTestAttemptAnswer[]
  proctorEvents         ProctorEvent[]

  @@index([testId])
  @@index([membershipId])
  @@index([membershipId, testId])
  @@index([status])
}

model ESTestAttemptAnswer {
  id                String         @id @default(cuid())
  attemptId         String
  questionId        String
  answerText        String?
  selectedOptionIds Json?
  numericAnswer     Decimal?       @db.Decimal(16, 6)
  pointsAwarded     Decimal?       @db.Decimal(5, 2)
  gradedAt          DateTime?
  graderNote        String?
  markedForReview   Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  attempt           ESTestAttempt  @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question          ESTestQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([attemptId, questionId])
  @@index([attemptId])
  @@index([questionId])
}

model Resource {
  id        String        @id @default(cuid())
  name      String
  tag       String
  url       String?
  category  String
  scope     ResourceScope @default(CLUB)
  clubId    String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  club      Club?         @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([clubId])
  @@index([scope])
}

model ResourceRequest {
  id              String                @id @default(cuid())
  name            String
  tag             String
  url             String?
  category        String
  scope           ResourceScope         @default(PUBLIC)
  clubId          String
  requestedById   String
  status          ResourceRequestStatus @default(PENDING)
  reviewedById    String?
  reviewedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  club            Club                  @relation("ResourceRequests", fields: [clubId], references: [id], onDelete: Cascade)
  requestedBy     Membership            @relation(fields: [requestedById], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([clubId])
  @@index([requestedById])
  @@index([createdAt])
}

model PromoCode {
  id                 String                @id @default(cuid())
  code               String                @unique
  effectType         PromoEffectType
  effectDuration     Int? // Duration in weeks for PRO_SUBSCRIPTION
  effectQuantity     Int? // Quantity of boosts for CLUB_BOOST
  activatesAt        DateTime? // When the promo code becomes active
  expiresAt          DateTime? // When the promo code expires
  maxRedemptions     Int? // Maximum number of total redemptions (null = unlimited)
  currentRedemptions Int                   @default(0) // Current number of redemptions
  createdById        String? // Dev who created it
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  redemptions        PromoCodeRedemption[]

  @@index([code])
  @@index([effectType])
  @@index([expiresAt])
}

model PromoCodeRedemption {
  id          String    @id @default(cuid())
  promoCodeId String
  userId      String
  redeemedAt  DateTime  @default(now())
  expiresAt   DateTime // When this redemption's benefits expire
  promoCode   PromoCode @relation(fields: [promoCodeId], references: [id], onDelete: Cascade)
  user        User      @relation("PromoCodeRedemptions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([promoCodeId, userId]) // Each user can only redeem a promo code once
  @@index([userId])
  @@index([promoCodeId])
  @@index([expiresAt])
}

model ClubBoost {
  id         String   @id @default(cuid())
  userId     String
  clubId     String
  assignedAt DateTime @default(now())
  expiresAt  DateTime // When this boost expires (end of the month it was assigned)
  sourceType String   @default("PROMO") // "PROMO", "PURCHASE", "PRO_SUBSCRIPTION"
  sourceId   String? // Reference to promo redemption or purchase
  user       User     @relation("UserClubBoosts", fields: [userId], references: [id], onDelete: Cascade)
  club       Club     @relation("ClubBoosts", fields: [clubId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clubId])
  @@index([expiresAt])
  @@index([assignedAt])
}

model DevAuditLog {
  id        String   @id @default(cuid())
  userId    String
  userEmail String
  userName  String?
  action    String // "LOGIN", "CREATE_PROMO", "DELETE_PROMO", "UPDATE_PROMO", "CREATE_BLOG", etc.
  target    String? // What was affected (e.g., promo code, blog post slug)
  details   Json? // Additional details about the action
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@index([userEmail])
}

enum Division {
  B
  C
}

enum Role {
  ADMIN
  MEMBER
}

enum AnnouncementScope {
  CLUB
  TEAM
}

enum CalendarScope {
  PERSONAL
  TEAM
  CLUB
}

enum RSVPStatus {
  YES
  NO
}

enum AttendanceStatus {
  UPCOMING
  ACTIVE
  ENDED
  CANCELLED
}

enum CheckInSource {
  CODE
  MANUAL
}

enum PurchaseRequestStatus {
  PENDING
  APPROVED
  DENIED
  COMPLETED
}

enum TestStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum QuestionType {
  MCQ_SINGLE
  MCQ_MULTI
  SHORT_TEXT
  LONG_TEXT
  NUMERIC
}

enum TestAssignmentScope {
  CLUB
  TEAM
  PERSONAL
}

enum AttemptStatus {
  NOT_STARTED
  IN_PROGRESS
  SUBMITTED
  GRADED
}

enum PromoEffectType {
  PRO_SUBSCRIPTION
  CLUB_BOOST
  INVALIDATED
}

enum ProctorEventKind {
  BLUR
  VISIBILITY_HIDDEN
  EXIT_FULLSCREEN
  DEVTOOLS_OPEN
  PASTE
  COPY
  CONTEXTMENU
  TAB_SWITCH
  RESIZE
  NETWORK_OFFLINE
  NETWORK_ONLINE
  MULTI_MONITOR_HINT
}

enum ScoreReleaseMode {
  NONE
  SCORE_ONLY
  SCORE_WITH_WRONG
  FULL_TEST
}

enum TestAuditAction {
  CREATE
  UPDATE
  DELETE
  PUBLISH
  CLOSE
  RESET_PASSWORD
  MANUAL_GRADE
  INVALIDATE_ATTEMPT
}

enum AiSuggestionStatus {
  REQUESTED
  SUGGESTED
  FAILED
  ACCEPTED
  OVERRIDDEN
  DISMISSED
}

enum LogType {
  USER_ACTION
  ADMIN_ACTION
  SYSTEM_EVENT
  API_USAGE
  ERROR
  WARNING
}

enum SeverityLevel {
  DEBUG
  INFO
  WARNING
  ERROR
  CRITICAL
}

enum HomeWidgetType {
  WELCOME_MESSAGE
  RECENT_ANNOUNCEMENTS
  UPCOMING_EVENTS
  TEAM_STATS
  QUICK_ACTIONS
  RECENT_ACTIVITY
  UPCOMING_TESTS
  CALENDAR_PREVIEW
  ATTENDANCE_SUMMARY
  FINANCE_OVERVIEW
  IMPORTANT_LINKS
  CUSTOM_TEXT
}

enum WidgetWidth {
  SMALL
  MEDIUM
  LARGE
  FULL
}

enum WidgetHeight {
  SMALL
  MEDIUM
  LARGE
  AUTO
}

enum MediaType {
  IMAGE
  VIDEO
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum CalculatorType {
  FOUR_FUNCTION
  SCIENTIFIC
  GRAPHING
}

enum NoteSheetType {
  CREATED
  UPLOADED
}

enum NoteSheetStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum TodoPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TournamentRegistrationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum TournamentHostingRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum StaffRole {
  EVENT_SUPERVISOR
  TOURNAMENT_DIRECTOR
}

enum StaffInviteStatus {
  PENDING
  ACCEPTED
  DECLINED
}

enum StudyNoteType {
  NOTE_SHEET
  BINDER
}

enum ResourceScope {
  CLUB
  PUBLIC
}

enum ResourceRequestStatus {
  PENDING
  APPROVED
  REJECTED
}
